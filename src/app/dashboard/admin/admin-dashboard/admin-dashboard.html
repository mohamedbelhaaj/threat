<!-- ============================================ -->
<!-- DASHBOARD ADMIN - VERSION SIMPLIFIÃ‰E -->
<!-- ============================================ -->

<div class="dashboard-container">
  
  <!-- HEADER -->
  <div class="dashboard-header">
    <h1><i class="fas fa-user-shield"></i> Admin Dashboard</h1>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="toggleServerModal()">
        <i class="fas fa-user-plus"></i> Add User
      </button>
      <button class="btn btn-success" (click)="generateSystemReport()">
        <i class="fas fa-chart-bar"></i> System Report
      </button>
    </div>
  </div>

  <!-- LOADING -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Loading admin dashboard...</p>
  </div>

  <!-- DASHBOARD CONTENT -->
  <div *ngIf="!loading">

    <!-- STATS CARDS -->
    <div class="stats-grid">
      <div class="stat-card">
        <i class="fas fa-users"></i>
        <div>
          <h3>{{ stats.totalUsers }}</h3>
          <p>Total Users</p>
          <span class="badge-success">{{ stats.activeUsers }} Active</span>
        </div>
      </div>

      <div class="stat-card">
        <i class="fas fa-server"></i>
        <div>
          <h3>{{ stats.totalServers }}</h3>
          <p>Servers</p>
          <span class="badge-warning">{{ stats.serversOnline }} Online</span>
        </div>
      </div>

      <div class="stat-card">
        <i class="fas fa-exclamation-triangle"></i>
        <div>
          <h3>{{ stats.totalThreats }}</h3>
          <p>All Threats</p>
          <span class="badge-danger">{{ stats.criticalThreats }} Critical</span>
        </div>
      </div>

      <div class="stat-card">
        <i class="fas fa-clipboard-list"></i>
        <div>
          <h3>{{ stats.totalTasks }}</h3>
          <p>All Tasks</p>
          <span class="badge-info">{{ stats.activeTasks }} Active</span>
        </div>
      </div>
    </div>

    <!-- ADD USER MODAL -->
    <div *ngIf="userModalVisible" class="modal-overlay" (click)="toggleServerModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3><i class="fas fa-user-plus"></i> Add New User</h3>
          <button (click)="toggleServerModal()"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Email:</label>
            <input type="email" [(ngModel)]="newUser.email" class="form-control" placeholder="user@example.com">
          </div>
          <div class="form-group">
            <label>Password:</label>
            <input type="password" [(ngModel)]="newUser.password" class="form-control" placeholder="Password">
          </div>
          <div class="form-group">
            <label>Role:</label>
            <select [(ngModel)]="newUser.role" class="form-control">
              <option value="SOC_ANALYST">SOC Analyst</option>
              <option value="SYSTEM_ADMIN">System Admin</option>
            </select>
          </div>
          <div class="form-group">
            <label>Telegram ID (Optional):</label>
            <input type="text" [(ngModel)]="newUser.telegramId" class="form-control" placeholder="@username">
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="toggleServerModal()">Cancel</button>
          <button class="btn btn-primary" (click)="createUser()" [disabled]="creating">
            {{ creating ? 'Creating...' : 'Create User' }}
          </button>
        </div>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="content-grid">

      <!-- USERS MANAGEMENT -->
      <div class="card">
        <div class="card-header">
          <h3><i class="fas fa-users"></i> User Management</h3>
          <div class="filter-group">
            <select [(ngModel)]="userFilter" (change)="filterUsers()" class="form-control-sm">
              <option value="ALL">All Users</option>
              <option value="SOC_ANALYST">SOC Analysts</option>
              <option value="SYSTEM_ADMIN">Admins</option>
              <option value="ACTIVE">Active Only</option>
            </select>
          </div>
        </div>
        <div class="card-body">
          <table class="table" *ngIf="users && users.length > 0; else noUsers">
            <thead>
              <tr>
                <th>Email</th>
                <th>Role</th>
                <th>Status</th>
                <th>Last Login</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of users">
                <td>
                  <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span>{{ user.email }}</span>
                  </div>
                </td>
                <td>
                  <span class="badge-role" [class]="'role-' + user.role">
                    {{ user.role }}
                  </span>
                </td>
                <td>
                  <span class="badge-status" [class.active]="user.active">
                    {{ user.active ? 'Active' : 'Inactive' }}
                  </span>
                </td>
                <td>{{ user.lastLogin ? (user.lastLogin | date:'short') : 'Never' }}</td>
                <td>
                  <button class="btn-sm btn-primary" [routerLink]="['/admin/users', user.userId]">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn-sm btn-danger" (click)="deleteServer(user.userId)" *ngIf="user.userId !== currentUserId">
                    <i class="fas fa-trash"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
          <ng-template #noUsers>
            <div class="empty-state">
              <i class="fas fa-users-slash"></i>
              <p>No users found</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- SERVERS MANAGEMENT -->
      <div class="card">
        <div class="card-header">
          <h3><i class="fas fa-server"></i> Servers & Services</h3>
          <button class="btn-sm btn-primary" (click)="toggleServerModal()">
            <i class="fas fa-plus"></i> Add Server
          </button>
        </div>
        <div class="card-body">
          <div *ngIf="servers && servers.length > 0; else noServers">
            <div class="server-item" *ngFor="let server of servers">
              <div class="server-header">
                <div class="server-info">
                  <i class="fas fa-server"></i>
                  <div>
                    <h4>{{ server.name }}</h4>
                    <p>{{ server.ipAddress }}</p>
                  </div>
                </div>
                <span class="server-status" [class]="'status-' + server.status">
                  <i class="fas fa-circle"></i>
                  {{ server.status }}
                </span>
              </div>
              <div class="server-metrics" *ngIf="server.cpu !== undefined">
                <div class="metric">
                  <label>CPU</label>
                  <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="server.cpu" [class.high]="server.cpu > 80"></div>
                  </div>
                  <span>{{ server.cpu }}%</span>
                </div>
                <div class="metric">
                  <label>RAM</label>
                  <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="server.ram" [class.high]="server.ram > 80"></div>
                  </div>
                  <span>{{ server.ram }}%</span>
                </div>
              </div>
              <div class="server-actions">
                <button class="btn-sm" (click)="viewServerLogs(server.serverId)">
                  <i class="fas fa-file-alt"></i> Logs
                </button>
                <button class="btn-sm btn-warning" (click)="restartServer(server.serverId)">
                  <i class="fas fa-redo"></i> Restart
                </button>
                <button class="btn-sm btn-danger" (click)="deleteServer(server.serverId)">
                  <i class="fas fa-trash"></i> Remove
                </button>
              </div>
            </div>
          </div>
          <ng-template #noServers>
            <div class="empty-state">
              <i class="fas fa-server"></i>
              <p>No servers configured</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- TASK ASSIGNMENT -->
      <div class="card">
        <div class="card-header">
          <h3><i class="fas fa-tasks"></i> Task Assignment</h3>
          <button class="btn-sm btn-primary" (click)="toggleTaskModal()">
            <i class="fas fa-plus"></i> Create Task
          </button> 
        </div>
     <div class="card-body">
  @for (task of assignTask; track task) {
    <div class="task-item">
      <div class="task-header">
        <span class="priority-badge" [class]="'priority-' + task.priority">
          <i class="fas fa-flag"></i>
        </span>
        <h4>{{ task.title }}</h4>
      </div>

      <p>{{ task.description | slice: 0:100 }}...</p>

      <div class="task-footer">
        <span class="badge">{{ task.status }}</span>
        <div class="task-actions">
          <select [(ngModel)]="task.selectedAnalyst" class="form-control-sm">
            <option value="">Select Analyst...</option>

            @for (analyst of analysts; track analyst) {
              <option [value]="analyst.userId">
                {{ analyst.email }}
              </option>
            }
          </select>
        </div>
      </div>
    </div>
  }
</div>
          <ng-template #noTasks>
            <div class="empty-state">
              <i class="fas fa-check-circle"></i>
              <p>All tasks assigned</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- FIREWALL CONFIGURATION -->
      <div class="card">
        <div class="card-header">
          <h3><i class="fas fa-shield-alt"></i> Firewall Configuration</h3>
          <button class="btn-sm btn-primary" (click)="toggleFirewallModal()">
            <i class="fas fa-plus"></i> Add Rule
          </button>
        </div>
        <div class="card-body">
          <div class="firewall-stats">
            <div class="stat-item">
              <i class="fas fa-ban"></i>
              <div>
                <h4>{{ stats.blockedIPs || 0 }}</h4>
                <p>Blocked IPs</p>
              </div>
            </div>
            <div class="stat-item">
              <i class="fas fa-globe"></i>
              <div>
                <h4>{{ stats.blockedDomains || 0 }}</h4>
                <p>Blocked Domains</p>
              </div>
            </div>
            <div class="stat-item">
              <i class="fas fa-shield-alt"></i>
              <div>
                <h4>{{ stats.firewallRules || 0 }}</h4>
                <p>Active Rules</p>
              </div>
            </div>
          </div>
          <div class="quick-actions">
            <button class="btn btn-warning" (click)="viewBlockedIPs()">
              <i class="fas fa-list"></i> View Blocked IPs
            </button>
            <button class="btn btn-info" (click)="viewBlockedDomains()">
              <i class="fas fa-globe"></i> View Blocked Domains
            </button>
          </div>
        </div>
      </div>

      <!-- SYSTEM ACTIVITY -->
      <div class="card">
        <div class="card-header">
          <h3><i class="fas fa-chart-line"></i> System Activity</h3>
          <select [(ngModel)]="activityFilter" class="form-control-sm">
            <option value="TODAY">Today</option>
            <option value="WEEK">This Week</option>
            <option value="MONTH">This Month</option>
          </select>
        </div>
        <div class="card-body">
          <div *ngIf="activities && activities.length > 0; else noActivity">
            <div class="activity-item" *ngFor="let activity of activities">
              <div class="activity-icon" [class]="'type-' + activity.type">
                <i class="fas" 
                   [class.fa-user-plus]="activity.type === 'USER_CREATED'"
                   [class.fa-shield-alt]="activity.type === 'THREAT_BLOCKED'"
                   [class.fa-tasks]="activity.type === 'TASK_ASSIGNED'"
                   [class.fa-file-alt]="activity.type === 'REPORT_GENERATED'"></i>
              </div>
              <div class="activity-content">
                <p>{{ activity.description }}</p>
                <span>{{ activity.timestamp | date:'short' }}</span>
              </div>
            </div>
          </div>
          <ng-template #noActivity>
            <div class="empty-state">
              <i class="fas fa-history"></i>
              <p>No recent activity</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- SYSTEM HEALTH -->
      <div class="card">
        <div class="card-header">
          <h3><i class="fas fa-heartbeat"></i> System Health</h3>
          <span class="health-status" [class.healthy]="systemHealth > 80">
            {{ systemHealth }}%
          </span>
        </div>
        <div class="card-body">
          <div class="health-metrics">
            <div class="metric-item">
              <label>Database</label>
              <div class="status-indicator" [class.healthy]="dbStatus === 'HEALTHY'">
                <i class="fas fa-circle"></i>
                {{ dbStatus }}
              </div>
            </div>
            <div class="metric-item">
              <label>Authentication</label>
              <div class="status-indicator" [class.healthy]="authStatus === 'HEALTHY'">
                <i class="fas fa-circle"></i>
                {{ authStatus }}
              </div>
            </div>
            <div class="metric-item">
              <label>Storage</label>
              <div class="status-indicator" [class.healthy]="storageStatus === 'HEALTHY'">
                <i class="fas fa-circle"></i>
                {{ storageStatus }}
              </div>
            </div>
          </div>
          <button class="btn btn-primary btn-block" (click)="runHealthCheck()">
            <i class="fas fa-sync-alt"></i> Run Health Check
          </button>
        </div>
      </div>

    </div>

  </div>

  <!-- CHATBOT BUTTON -->
  <button class="chatbot-btn" (click)="toggleChatbot()">
    <i class="fas fa-robot"></i>
  </button>

